<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Biz Connect</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #f8f9fa; }
        .card-hover:hover { transform: translateY(-2px); transition: 0.3s; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .fab { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; border-radius: 30px; font-size: 24px; display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .loading-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(255,255,255,0.8); z-index: 2000; display: none; justify-content: center; align-items: center; }
    </style>
</head>
<body>

    <!-- ë¡œë”© í™”ë©´ -->
    <div id="loading" class="loading-overlay">
        <div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>
    </div>

    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="login-screen" class="container vh-100 d-flex flex-column justify-content-center align-items-center">
        <i class="fas fa-university fa-5x text-primary mb-4"></i>
        <h1 class="fw-bold">AI Biz Connect</h1>
        <p class="text-muted mb-5">AIê²½ì˜í•™ê³¼ í•™ìƒë“¤ì„ ìœ„í•œ ì†Œí†µ ê³µê°„</p>
        <button class="btn btn-outline-dark btn-lg px-5" onclick="googleLogin()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20" class="me-2">
            Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
        </button>
    </div>

    <!-- ë©”ì¸ ì•± í™”ë©´ (ì´ˆê¸°ì—” ìˆ¨ê¹€) -->
    <div id="app-screen" style="display: none;">
        <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
            <div class="container">
                <a class="navbar-brand fw-bold" href="#"><i class="fas fa-graduation-cap me-2"></i>AI Biz Connect</a>
                <div class="d-flex align-items-center">
                    <span id="user-name" class="text-white me-3 small"></span>
                    <button class="btn btn-sm btn-light text-primary" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
        </nav>

        <!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
        <div class="container mt-3">
            <ul class="nav nav-pills nav-fill bg-white rounded shadow-sm p-2 mb-4">
                <li class="nav-item"><a class="nav-link active" id="tab-QA" onclick="changeTab('QA')" href="#">ğŸ“š Q&A</a></li>
                <li class="nav-item"><a class="nav-link" id="tab-Community" onclick="changeTab('Community')" href="#">ğŸ’¬ ì†Œí†µ</a></li>
                <li class="nav-item"><a class="nav-link" id="tab-Info" onclick="changeTab('Info')" href="#">ğŸ’¡ ì •ë³´ê³µìœ </a></li>
            </ul>

            <!-- ê²Œì‹œê¸€ ëª©ë¡ ì˜ì—­ -->
            <div id="post-list" class="row g-3">
                <!-- JSë¡œ ê²Œì‹œê¸€ì´ ì—¬ê¸°ì— ë Œë”ë§ ë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ê¸€ì“°ê¸° ë²„íŠ¼ (FAB) -->
        <button class="btn btn-primary shadow fab" data-bs-toggle="modal" data-bs-target="#writeModal">
            <i class="fas fa-pen"></i>
        </button>
    </div>

    <!-- ê¸€ì“°ê¸° ëª¨ë‹¬ -->
    <div class="modal fade" id="writeModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ìƒˆ ê²Œì‹œê¸€ ì‘ì„±</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="post-title" class="form-control mb-2" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                    <textarea id="post-content" class="form-control" rows="5" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary w-100" onclick="savePost()">ë“±ë¡í•˜ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ìƒì„¸ ë³´ê¸° ëª¨ë‹¬ -->
    <div class="modal fade" id="detailModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold" id="detail-title">ì œëª©</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-between text-muted small mb-3">
                        <span id="detail-author">ì‘ì„±ì</span>
                        <span id="detail-date">ë‚ ì§œ</span>
                    </div>
                    <div id="detail-content" class="mb-4" style="white-space: pre-wrap;">ë‚´ìš©</div>
                    <hr>
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-indigo border-primary text-primary" onclick="translateContent()">
                            <i class="fas fa-language me-2"></i>í•œêµ­ì–´ â†” English ë²ˆì—­ (AI)
                        </button>
                    </div>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-danger" id="btn-delete" onclick="deletePost()" style="display:none;">ì‚­ì œ</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // --- 1. Firebase ì„¤ì • & ì´ˆê¸°í™” ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, orderBy, onSnapshot, doc, deleteDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // [ì¤‘ìš”] ì•„ë˜ ì„¤ì •ì„ ë³¸ì¸ì˜ Firebase í”„ë¡œì íŠ¸ ì„¤ì •ìœ¼ë¡œ êµì²´í•˜ì„¸ìš”!
        const firebaseConfig = {
            apiKey: "AIzaSyBh9AXs-LUfO2scMYACKvPhEsL9_uk4aU0",
  authDomain: "ai-sns-77104.firebaseapp.com",
  databaseURL: "https://ai-sns-77104-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "ai-sns-77104",
  storageBucket: "ai-sns-77104.appspot.com",
  messagingSenderId: "112330694038",
  appId: "1:112330694038:web:1368e4a7337cbcf43c11b7"
        };

        // ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // ì „ì—­ ë³€ìˆ˜
        let currentUser = null;
        let currentCategory = 'QA';
        let currentPostId = null; // ìƒì„¸ë³´ê¸°ë¥¼ ìœ„í•œ ID
        let postsData = []; // í˜„ì¬ ë¡œë“œëœ ê²Œì‹œê¸€ ë°ì´í„°

        // --- 2. ì¸ì¦ ê´€ë ¨ í•¨ìˆ˜ ---
        window.googleLogin = () => {
            signInWithPopup(auth, provider).catch((error) => alert(error.message));
        };

        window.logout = () => {
            signOut(auth).then(() => location.reload());
        };

        // ë¡œê·¸ì¸ ìƒíƒœ ê°ì§€
        onAuthStateChanged(auth, (user) => {
            const loginScreen = document.getElementById('login-screen');
            const appScreen = document.getElementById('app-screen');
            
            if (user) {
                currentUser = user;
                document.getElementById('user-name').innerText = `${user.displayName}ë‹˜`;
                loginScreen.style.display = 'none';
                appScreen.style.display = 'block';
                loadPosts(currentCategory); // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
            } else {
                currentUser = null;
                loginScreen.style.display = 'flex';
                appScreen.style.display = 'none';
            }
        });

        // --- 3. ê²Œì‹œíŒ ë¡œì§ (CRUD) ---
        
        // íƒ­ ë³€ê²½
        window.changeTab = (category) => {
            currentCategory = category;
            // UI íƒ­ í™œì„±í™” ë³€ê²½
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
            document.getElementById(`tab-${category}`).classList.add('active');
            loadPosts(category);
        };

        // ê²Œì‹œê¸€ ë¶ˆëŸ¬ì˜¤ê¸° (ì‹¤ì‹œê°„)
        function loadPosts(category) {
            document.getElementById('loading').style.display = 'flex';
            const q = query(collection(db, "posts"), where("category", "==", category), orderBy("createdAt", "desc"));
            
            onSnapshot(q, (snapshot) => {
                const listContainer = document.getElementById('post-list');
                listContainer.innerHTML = '';
                postsData = [];

                snapshot.forEach((doc) => {
                    const post = doc.data();
                    post.id = doc.id;
                    postsData.push(post);

                    const date = post.createdAt ? new Date(post.createdAt.toDate()).toLocaleDateString() : 'ë°©ê¸ˆ ì „';
                    
                    const html = `
                        <div class="col-12 col-md-6">
                            <div class="card card-hover border-0 shadow-sm h-100" onclick="openDetail('${post.id}')">
                                <div class="card-body">
                                    <h5 class="card-title text-truncate fw-bold">${post.title}</h5>
                                    <p class="card-text text-muted text-truncate small">${post.content}</p>
                                    <div class="d-flex justify-content-between align-items-center mt-3">
                                        <small class="text-primary"><i class="fas fa-user me-1"></i>${post.authorName}</small>
                                        <small class="text-muted">${date}</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    listContainer.innerHTML += html;
                });
                document.getElementById('loading').style.display = 'none';
            });
        }

        // ê²Œì‹œê¸€ ì €ì¥
        window.savePost = async () => {
            const title = document.getElementById('post-title').value;
            const content = document.getElementById('post-content').value;

            if (!title || !content) return alert("ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

            try {
                await addDoc(collection(db, "posts"), {
                    title: title,
                    content: content,
                    category: currentCategory,
                    authorName: currentUser.displayName,
                    authorUid: currentUser.uid,
                    createdAt: serverTimestamp()
                });
                
                // ëª¨ë‹¬ ë‹«ê¸° ë° ì´ˆê¸°í™”
                const modalEl = document.getElementById('writeModal');
                const modal = bootstrap.Modal.getInstance(modalEl);
                modal.hide();
                document.getElementById('post-title').value = '';
                document.getElementById('post-content').value = '';
                
            } catch (e) {
                console.error("Error adding document: ", e);
                alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        };

        // ìƒì„¸ ë³´ê¸° ì—´ê¸°
        window.openDetail = (id) => {
            currentPostId = id;
            const post = postsData.find(p => p.id === id);
            if (!post) return;

            document.getElementById('detail-title').innerText = post.title;
            document.getElementById('detail-content').innerText = post.content;
            document.getElementById('detail-author').innerText = post.authorName;
            document.getElementById('detail-date').innerText = post.createdAt ? new Date(post.createdAt.toDate()).toLocaleString() : '';

            // ì‚­ì œ ë²„íŠ¼: ë³¸ì¸ ê¸€ì¼ ë•Œë§Œ í‘œì‹œ
            const deleteBtn = document.getElementById('btn-delete');
            if (post.authorUid === currentUser.uid) {
                deleteBtn.style.display = 'block';
            } else {
                deleteBtn.style.display = 'none';
            }

            const modal = new bootstrap.Modal(document.getElementById('detailModal'));
            modal.show();
        };

        // ê²Œì‹œê¸€ ì‚­ì œ
        window.deletePost = async () => {
            if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            try {
                await deleteDoc(doc(db, "posts", currentPostId));
                const modalEl = document.getElementById('detailModal');
                const modal = bootstrap.Modal.getInstance(modalEl);
                modal.hide();
            } catch (e) {
                alert("ì‚­ì œ ê¶Œí•œì´ ì—†ê±°ë‚˜ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        };

        // --- 4. ë²ˆì—­ ê¸°ëŠ¥ (ë¬´ë£Œ API í™œìš©) ---
        window.translateContent = async () => {
            const titleEl = document.getElementById('detail-title');
            const contentEl = document.getElementById('detail-content');
            
            const originalText = contentEl.innerText;
            const originalTitle = titleEl.innerText;
            
            // ë¡œë”© í‘œì‹œ
            contentEl.innerText = "Translating...";
            
            try {
                // MyMemory Translation API (ë¬´ë£Œ, ì¼ì¼ ì œí•œ ìˆìŒ)
                // ì‹¤ì œ ì„œë¹„ìŠ¤ì‹œ Google Cloud Translation API ì‚¬ìš© ê¶Œì¥
                const translate = async (text) => {
                    // í•œê¸€ì´ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ -> ì˜ì–´ë¡œ, ì•„ë‹ˆë©´ -> í•œêµ­ì–´ë¡œ
                    const langPair = /[ã„±-ã…|ã…-ã…£|ê°€-í£]/.test(text) ? 'ko|en' : 'en|ko';
                    const res = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${langPair}`);
                    const data = await res.json();
                    return data.responseData.translatedText;
                };

                const newTitle = await translate(originalTitle);
                const newContent = await translate(originalText);

                titleEl.innerText = newTitle;
                contentEl.innerText = newContent;

            } catch (e) {
                alert("ë²ˆì—­ ì„œë¹„ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
                contentEl.innerText = originalText; // ë³µêµ¬
            }
        };
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
